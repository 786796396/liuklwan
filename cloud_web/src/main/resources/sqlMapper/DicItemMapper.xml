<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ucap.cloud_web.dao.DicItemDao">


	<resultMap type="com.ucap.cloud_web.entity.DicItem" id="resultMap"/>

	<sql id="where">
		<where>
			1=1
			<if test="pid != null ">
				and pId=${pid}
			</if>
			<if test="delStatus != null ">
				and del_status=${delStatus}
			</if>
			<if test="enName != null ">
				and en_name=#{enName}
			</if>
		</where>
	</sql>

	<!-- 添加 -->
	<insert id="add" parameterType="com.ucap.cloud_web.entity.DicItem" useGeneratedKeys="true" keyProperty="id">
		insert into dic_item ( 
			<if test="id != null ">id,</if>
			<if test="pId != null ">pId,</if>
			<if test="name != null ">name,</if>
			<if test="enName != null ">en_name,</if>
			<if test="value != null ">value,</if>
			<if test="remark != null ">remark,</if>
			<if test="code != null ">code,</if>
			<if test="status != null ">status,</if>
			<if test="isParent != null ">is_parent,</if>
			<if test="delStatus != null ">del_status,</if>
			create_time,
			modify_time
		) values (
			<if test="id != null ">#{id},</if>
			<if test="pId != null ">#{pId},</if>
			<if test="name != null ">#{name},</if>
			<if test="enName != null ">#{enName},</if>
			<if test="value != null ">#{value},</if>
			<if test="remark != null ">#{remark},</if>
			<if test="code != null ">#{code},</if>
			<if test="status != null ">#{status},</if>
			<if test="isParent != null ">#{isParent},</if>
			<if test="delStatus != null ">#{delStatus},</if>
			now(),
			now()
		)
		<selectKey resultType="int" keyProperty="id">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
	</insert>

	<!-- 查询 -->
	<select id="get" parameterType="int" resultType="com.ucap.cloud_web.entity.DicItem">
		select * from dic_item where id=#{id}
	</select>

	<!-- 修改 -->
	<update id="update" parameterType="com.ucap.cloud_web.entity.DicItem">
		update dic_item 
			<trim prefix="SET" suffixOverrides=",">
				<if test="id != null ">id = #{id},</if>
				<if test="pId != null ">pId = #{pId},</if>
				<if test="name != null ">name = #{name},</if>
				<if test="enName != null ">en_name = #{enName},</if>
				<if test="value != null ">value = #{value},</if>
				<if test="remark != null ">remark = #{remark},</if>
				<if test="code != null ">code = #{code},</if>
				<if test="status != null ">status = #{status},</if>
				<if test="isParent != null ">is_parent = #{isParent},</if>
				<if test="delStatus != null ">del_status = #{delStatus},</if>
				<if test="createTime != null ">create_time = #{createTime},</if>
				<if test="modifyTime != null ">modify_time = #{modifyTime},</if>
			</trim>
			where id=#{id} 
	</update>

	<!-- 删除 -->
	<delete id="delete" parameterType="int">
		delete from dic_item where id = #{id}
	</delete>

	<!-- 分页查询 -->
	<select id="query" parameterType="HashMap" resultMap="resultMap">
		select * from dic_item
		<include refid="where"/>
		<if test="queryOrderList != null">
			order by
			<foreach collection="queryOrderList" item="queryOrder" separator=",">
				${queryOrder}
			</foreach>
		</if>
		<if test="start != null and pageSize != null">
			limit #{start}, #{pageSize}
		</if>
	</select>
	<select id="queryCount" parameterType="HashMap" resultType="int">
		select count(*) from dic_item
		<include refid="where" />
	</select>
	
	<select id="queryImgSize" parameterType="HashMap" resultMap="resultMap">
	    select a.name,a.value from dic_item a
		inner join dic_item b ON a.pId = b.id and b.del_status = 0
		where b.en_name = #{enName}  and a.del_status = 0
	</select>
		<!-- 根据 父节点  enName 查询 -->
	<select id="queryByPEnName" parameterType="String" resultMap="resultMap">
		select a.* from dic_item a
		inner join dic_item b ON a.pId = b.id and b.del_status = 0
		where b.en_name = #{pEnName} and a.del_status = 0
		order by sort asc;
	</select>
	<!-- 根据英文名称查询数量 -->
	<select id="queryCountByEnName" parameterType="String" resultType="int">
		select count(1) from dic_item where en_name = #{enName} and del_status = 0
	</select>
	
		<!-- 根据英文名称查询 -->
	<select id="getByEnName" parameterType="String" resultType="com.ucap.cloud_web.entity.DicItem">
		select * from dic_item where en_name = #{enName} and del_status = 0
	</select>
	
	<!-- 根据 pid 查询 -->
	<select id="queryByPid" parameterType="int" resultMap="resultMap">
		select * from dic_item where pId = #{pId} and del_status = 0
	</select>
	


</mapper>
