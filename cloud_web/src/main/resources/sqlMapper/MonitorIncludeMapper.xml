<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ucap.cloud_web.dao.MonitorIncludeDao">

	<cache eviction="LRU" flushInterval="60000" size="1024" readOnly="true"/>

	<resultMap type="com.ucap.cloud_web.entity.MonitorInclude" id="resultMap"/>

	<sql id="where">
		<where>
			1 = 1
			<if test="siteCode != null ">
				and site_code=#{siteCode}
			</if>
			<if test="scanDate != null ">
				and scan_date=#{scanDate}
			</if>
			<if test="beginScanDate !=null and endScanDate !=null">
				and scan_date BETWEEN #{beginScanDate} AND #{endScanDate}
			</if>
		</where>
	</sql>

	<!-- 添加 -->
	<insert id="add" parameterType="com.ucap.cloud_web.entity.MonitorInclude" useGeneratedKeys="true" keyProperty="id">
		insert into monitor_include ( 
			<if test="id != null ">id,</if>
			crawl_date,
			<if test="siteCode != null ">site_code,</if>
			<if test="webSite != null ">web_site,</if>
			<if test="domain != null ">domain,</if>
			<if test="baiduSlWebsite != null ">baidu_sl_website,</if>
			<if test="qihuSlWebsite != null ">qihu_sl_website,</if>
			<if test="sogouSlWebsite != null ">sogou_sl_website,</if>
			<if test="googleSlWebsite != null ">google_sl_website,</if>
			<if test="baiduSlDomainsite != null ">baidu_sl_domainsite,</if>
			<if test="qihuSlDomainsite != null ">qihu_sl_domainsite,</if>
			<if test="sogouSlDomainsite != null ">sogou_sl_domainsite,</if>
			<if test="googleSlDomainsite != null ">google_sl_domainsite,</if>
			<if test="beianDanwei != null ">beian_danwei,</if>
			<if test="anquanZhuangtai != null ">anquan_zhuangtai,</if>
			<if test="anquanDjc != null ">anquan_djc,</if>
			<if test="anquanDmjc != null ">anquan_dmjc,</if>
			<if test="anquanCgjc != null ">anquan_cgjc,</if>
			<if test="anquanNrjc != null ">anquan_nrjc,</if>
			<if test="jiankongQizha != null ">jiankong_qizha,</if>
			<if test="jiankongGuama != null ">jiankong_guama,</if>
			<if test="jiankongWeifa != null ">jiankong_weifa,</if>
			<if test="jiankongFuwuqi != null ">jiankong_fuwuqi,</if>
			<if test="scanDate != null ">scan_date,</if>
			<if test="reference != null ">reference,</if>
			create_time,
			modify_time
		) values (
			<if test="id != null ">#{id},</if>
			now(),
			<if test="siteCode != null ">#{siteCode},</if>
			<if test="webSite != null ">#{webSite},</if>
			<if test="domain != null ">#{domain},</if>
			<if test="baiduSlWebsite != null ">#{baiduSlWebsite},</if>
			<if test="qihuSlWebsite != null ">#{qihuSlWebsite},</if>
			<if test="sogouSlWebsite != null ">#{sogouSlWebsite},</if>
			<if test="googleSlWebsite != null ">#{googleSlWebsite},</if>
			<if test="baiduSlDomainsite != null ">#{baiduSlDomainsite},</if>
			<if test="qihuSlDomainsite != null ">#{qihuSlDomainsite},</if>
			<if test="sogouSlDomainsite != null ">#{sogouSlDomainsite},</if>
			<if test="googleSlDomainsite != null ">#{googleSlDomainsite},</if>
			<if test="beianDanwei != null ">#{beianDanwei},</if>
			<if test="anquanZhuangtai != null ">#{anquanZhuangtai},</if>
			<if test="anquanDjc != null ">#{anquanDjc},</if>
			<if test="anquanDmjc != null ">#{anquanDmjc},</if>
			<if test="anquanCgjc != null ">#{anquanCgjc},</if>
			<if test="anquanNrjc != null ">#{anquanNrjc},</if>
			<if test="jiankongQizha != null ">#{jiankongQizha},</if>
			<if test="jiankongGuama != null ">#{jiankongGuama},</if>
			<if test="jiankongWeifa != null ">#{jiankongWeifa},</if>
			<if test="jiankongFuwuqi != null ">#{jiankongFuwuqi},</if>
			<if test="scanDate != null ">#{scanDate},</if>
			<if test="reference != null ">#{reference},</if>
			now(),
			now()
		)
		<selectKey resultType="int" keyProperty="id">
			SELECT LAST_INSERT_ID() AS id
		</selectKey>
	</insert>

	<!-- 查询 -->
	<select id="get" parameterType="int" resultType="com.ucap.cloud_web.entity.MonitorInclude">
		select * from monitor_include where id=#{id}
	</select>

	<!-- 修改 -->
	<update id="update" parameterType="com.ucap.cloud_web.entity.MonitorInclude">
		update monitor_include 
			<trim prefix="SET" suffixOverrides=",">
				<if test="id != null ">id = #{id},</if>
				<if test="crawlDate != null ">crawl_date = #{crawlDate},</if>
				<if test="siteCode != null ">site_code = #{siteCode},</if>
				<if test="webSite != null ">web_site = #{webSite},</if>
				<if test="domain != null ">domain = #{domain},</if>
				<if test="baiduSlWebsite != null ">baidu_sl_website = #{baiduSlWebsite},</if>
				<if test="qihuSlWebsite != null ">qihu_sl_website = #{qihuSlWebsite},</if>
				<if test="sogouSlWebsite != null ">sogou_sl_website = #{sogouSlWebsite},</if>
				<if test="googleSlWebsite != null ">google_sl_website = #{googleSlWebsite},</if>
				<if test="baiduSlDomainsite != null ">baidu_sl_domainsite = #{baiduSlDomainsite},</if>
				<if test="qihuSlDomainsite != null ">qihu_sl_domainsite = #{qihuSlDomainsite},</if>
				<if test="sogouSlDomainsite != null ">sogou_sl_domainsite = #{sogouSlDomainsite},</if>
				<if test="googleSlDomainsite != null ">google_sl_domainsite = #{googleSlDomainsite},</if>
				<if test="beianDanwei != null ">beian_danwei = #{beianDanwei},</if>
				<if test="anquanZhuangtai != null ">anquan_zhuangtai = #{anquanZhuangtai},</if>
				<if test="anquanDjc != null ">anquan_djc = #{anquanDjc},</if>
				<if test="anquanDmjc != null ">anquan_dmjc = #{anquanDmjc},</if>
				<if test="anquanCgjc != null ">anquan_cgjc = #{anquanCgjc},</if>
				<if test="anquanNrjc != null ">anquan_nrjc = #{anquanNrjc},</if>
				<if test="jiankongQizha != null ">jiankong_qizha = #{jiankongQizha},</if>
				<if test="jiankongGuama != null ">jiankong_guama = #{jiankongGuama},</if>
				<if test="jiankongWeifa != null ">jiankong_weifa = #{jiankongWeifa},</if>
				<if test="jiankongFuwuqi != null ">jiankong_fuwuqi = #{jiankongFuwuqi},</if>
				<if test="scanDate != null ">scan_date = #{scanDate},</if>
				<if test="reference != null ">reference = #{reference},</if>
				<if test="createTime != null ">create_time = #{createTime},</if>
				<if test="modifyTime != null ">modify_time = #{modifyTime},</if>
			</trim>
			where id=#{id} 
	</update>

	<!-- 删除 -->
	<delete id="delete" parameterType="int">
		delete from monitor_include where id = #{id}
	</delete>

	<!-- 分页查询 -->
	<select id="query" parameterType="HashMap" resultMap="resultMap">
		select * from monitor_include
		<include refid="where"/>
		<if test="queryOrderList != null">
			order by
			<foreach collection="queryOrderList" item="queryOrder" separator=",">
				${queryOrder}
			</foreach>
		</if>
		<if test="start != null and pageSize != null">
			limit #{start}, #{pageSize}
		</if>
	</select>
	<select id="queryCount" parameterType="HashMap" resultType="int">
		select count(*) from monitor_include
		<include refid="where" />
	</select>
	
	<select id="queryTBMaxDate" parameterType="HashMap" resultType="String">
		select max(scan_date) from monitor_include
		<include refid="where" />
	</select>
	<select id="queryNatives" parameterType="HashMap" resultType="com.ucap.cloud_web.entity.MonitorInclude">
		SELECT j.*,d.jump_url jumpUrl,d.url url,d.name from database_tree_info t   
		join  monitor_include j on j.site_code = t.site_code 
		join  database_info d  on d.site_code = t.site_code 
		where  j.scan_date = #{scanDate} and t.parent_id =  #{parentId}  and d.isexp = 1
		 and t.is_bigdata=1
	</select>
	<select id="querySiteData" parameterType="HashMap" resultType="com.ucap.cloud_web.entity.MonitorInclude">
		select m.*,d.jump_url jumpUrl,d.url url,d.name from monitor_include m  
		join database_tree_info t on  m.site_code = t.site_code
		join database_info d on m.site_code = d.site_code
		where m.scan_date = #{scanDate} and  t.code like CONCAT(#{code},'%')  and d.isexp = 1  and t.is_bigdata=1
	</select>
	
	<select id="getSearchEngineList" parameterType="HashMap" resultType="com.ucap.cloud_web.dtoResponse.SearchEngineResponse">
		SELECT
			d.site_code siteCode,
			d.`name` NAME,
			d.url url,
			d.jump_url jumpUrl,
			dti.layer_type layerType,
			mi.baidu_sl_website baiduSlWebsite,
			mi.baidu_sl_domainsite baiduSlDomainsite
		FROM
			monitor_include mi,
			database_info d,
			database_tree_info dti
		WHERE
			mi.site_code = dti.site_code
		AND d.site_code = dti.site_code
		<if test="orgSiteCode != null">
			and dti.org_site_code= #{orgSiteCode}
		</if>
		<if test="isLink != null">
			and dti.is_link = #{isLink}
		</if>
		<if test="siteType != null">
			and dti.layer_type = #{siteType}
		</if>
		<if test="scanDate != null ">
			and mi.scan_date = #{scanDate}
		</if>
		<if test="isExp != null">
			AND d.isexp = #{isExp}
		</if>
	</select>
</mapper>
